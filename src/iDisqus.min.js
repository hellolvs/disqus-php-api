!function(global){"use strict";function getLocation(href){var link=d.createElement("a");return link.href=href,link}function getAjax(url,success,error){var xhr=new XMLHttpRequest;return xhr.open("GET",encodeURI(url)),xhr.onreadystatechange=function(){4==xhr.readyState&&200==xhr.status&&success(xhr.responseText)},xhr.onerror=error,xhr.send(),xhr}function postAjax(url,data,success,error){var params="string"==typeof data?data:Object.keys(data).map(function(k){return encodeURIComponent(k)+"="+encodeURIComponent(data[k])}).join("&"),xhr=new XMLHttpRequest;return xhr.open("POST",url),xhr.onreadystatechange=function(){4==xhr.readyState&&200==xhr.status&&success(xhr.responseText)},xhr.onerror=error,xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send(params),xhr}function addListener(els,evt,func){[].forEach.call(els,function(item){item.addEventListener(evt,func,!1)})}function removeListener(els,evt,func){[].forEach.call(els,function(item){item.removeEventListener(evt,func,!1)})}var d=document,l=localStorage,scripts=d.scripts,lasturl=scripts[scripts.length-1].src,filepath=lasturl.substring(0,lasturl.lastIndexOf("/"));!function(ElementProto){"function"!=typeof ElementProto.matches&&(ElementProto.matches=ElementProto.msMatchesSelector||ElementProto.mozMatchesSelector||ElementProto.webkitMatchesSelector||function(selector){for(var element=this,elements=(element.document||element.ownerDocument).querySelectorAll(selector),index=0;elements[index]&&elements[index]!==element;)++index;return Boolean(elements[index])}),"function"!=typeof ElementProto.closest&&(ElementProto.closest=function(selector){for(var element=this;element&&1===element.nodeType;){if(element.matches(selector))return element;element=element.parentNode}return null})}(window.Element.prototype);var Guest=function(){this.dom=arguments[0],this.init()};Guest.prototype={init:function(){var _=this;_.name=l.getItem("name"),_.email=l.getItem("email"),_.url=l.getItem("url"),_.avatar=l.getItem("avatar"),_.logged_in=l.getItem("logged_in");var boxarr=_.dom.getElementsByClassName("comment-box");"true"==_.logged_in?[].forEach.call(boxarr,function(item){item.querySelector(".comment-form-wrapper").classList.add("logged-in"),item.querySelector(".comment-form-name").value=_.name,item.querySelector(".comment-form-email").value=_.email,item.querySelector(".comment-form-url").value=_.url,item.querySelector(".comment-avatar-image").src=_.avatar}):([].forEach.call(boxarr,function(item){item.querySelector(".comment-form-wrapper").classList.remove("logged-in"),item.querySelector(".comment-form-name").value=_.name,item.querySelector(".comment-form-email").value=_.email,item.querySelector(".comment-form-url").value=_.url,item.querySelector(".comment-avatar-image").src=_.avatar?_.avatar:item.querySelector(".comment-avatar-image").src}),l.setItem("logged_in","false"))},reset:function(){l.setItem("logged_in","false"),this.init()},submit:function(g){"false"==this.logged_in&&(l.setItem("name",g.name),l.setItem("email",g.email),l.setItem("url",g.url),l.setItem("avatar",g.avatar),l.setItem("logged_in","true"),this.init())}};var iDisqus=function(){var _=this;if(_.opts="object"==typeof arguments[1]?arguments[1]:arguments[0],_.dom=d.getElementById("string"==typeof arguments[0]?arguments[0]:"comment"),_.opts.api="/"==_.opts.api.slice(-1)?_.opts.api.slice(0,-1):_.opts.api,_.opts.site=_.opts.site?_.opts.site:location.origin,_.opts.url){var optsUrl=_.opts.url.replace(_.opts.site,"");_.opts.url="/"!=optsUrl.slice(0,1)?"/"+optsUrl:optsUrl}else _.opts.url=location.pathname+location.search;_.opts.identifier=_.opts.identifier?_.opts.identifier:_.opts.url,_.opts.identifier="/"!=_.opts.identifier.slice(0,1)?"/"+_.opts.identifier:_.opts.identifier,_.opts.link=_.opts.site+_.opts.url,_.opts.title=_.opts.title?_.opts.title:d.title,_.opts.slug=_.opts.slug?_.opts.slug.replace(/[^A-Za-z0-9_-]+/g,""):"",_.opts.desc=_.opts.desc?_.opts.desc:d.querySelector('[name="description"]')?d.querySelector('[name="description"]').content:"",_.opts.mode=_.opts.mode?_.opts.mode:1,_.opts.timeout=_.opts.timeout?_.opts.timeout:3e3,_.opts.toggle=_.opts.toggle?d.getElementById(_.opts.toggle):null,_.opts.badge=_.opts.badge?_.opts.badge:"管理员",_.opts.emoji_path=_.opts.emoji_path?_.opts.emoji_path:"https://assets-cdn.github.com/images/icons/emoji/unicode/",_.emoji_list=_.opts.emoji_list?_.opts.emoji_list:[{code:"smile",title:"笑脸",unicode:"1f604"},{code:"mask",title:"生病",unicode:"1f637"},{code:"joy",title:"破涕为笑",unicode:"1f602"},{code:"stuck_out_tongue_closed_eyes",title:"吐舌",unicode:"1f61d"},{code:"flushed",title:"脸红",unicode:"1f633"},{code:"scream",title:"恐惧",unicode:"1f631"},{code:"pensive",title:"失望",unicode:"1f614"},{code:"unamused",title:"无语",unicode:"1f612"},{code:"grin",title:"露齿笑",unicode:"1f601"},{code:"heart_eyes",title:"色",unicode:"1f60d"},{code:"sweat",title:"汗",unicode:"1f613"},{code:"smirk",title:"得意",unicode:"1f60f"},{code:"relieved",title:"满意",unicode:"1f60c"},{code:"rolling_eyes",title:"翻白眼",unicode:"1f644"},{code:"ok_hand",title:"OK",unicode:"1f44c"},{code:"v",title:"胜利",unicode:"270c"}],_.opts.emoji_preview&&getAjax(filepath+"/eac.min.json",function(resp){_.eac=JSON.parse(resp)},function(){}),_.stat={current:"idisqus",loaded:!1,loading:!1,editing:!1,offsetTop:0,thread:null,next:null,message:null,mediaHtml:null,root:[],count:0,users:[],imageSize:[],disqusLoaded:!1},window.disqus_config=function(){this.page.identifier=_.opts.identifier,this.page.title=_.opts.title,this.page.url=_.opts.link,this.callbacks.onReady.push(function(){_.stat.current="disqus",_.stat.disqusLoaded=!0,_.dom.querySelector("#idisqus").style.display="none",_.dom.querySelector("#disqus_thread").style.display="block",3==_.opts.mode&&_.opts.toggle&&(_.opts.toggle.disabled="",_.opts.toggle.checked=!0,_.opts.toggle.addEventListener("change",_.handle.toggle,!1))})},_.opts.init&&_.init()};iDisqus.prototype.timeAgo=function(){var _=this,templates={prefix:"",suffix:"前",seconds:"几秒",minute:"1分钟",minutes:"%d分钟",hour:"1小时",hours:"%d小时",day:"1天",days:"%d天",month:"1个月",months:"%d个月",year:"1年",years:"%d年"},template=function(t,n){return templates[t]&&templates[t].replace(/%d/i,Math.abs(Math.round(n)))},elements=_.dom.querySelectorAll(".comment-item-time");for(var i in elements){var $this=elements[i];"object"==typeof $this&&($this.title=new Date($this.getAttribute("datetime")),$this.innerHTML=function(time){if(time){time=(time=(time=(time=time.replace(/\.\d+/,"")).replace(/-/,"/").replace(/-/,"/")).replace(/T/," ").replace(/Z/," UTC")).replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),time=new Date(1e3*time||time);var seconds=.001*((new Date).getTime()-time)>>0,minutes=seconds/60,hours=minutes/60,days=hours/24,years=days/365;return templates.prefix+(seconds<45&&template("seconds",seconds)||seconds<90&&template("minute",1)||minutes<45&&template("minutes",minutes)||minutes<90&&template("hour",1)||hours<24&&template("hours",hours)||hours<42&&template("day",1)||days<30&&template("days",days)||days<45&&template("month",1)||days<365&&template("months",days/30)||years<1.5&&template("year",1)||template("years",years))+templates.suffix}}($this.getAttribute("datetime")))}setTimeout(_.timeAgo.bind(_),6e4)},iDisqus.prototype.init=function(){var _=this;if(_.dom){var emojiList="";switch(_.emoji_list.forEach(function(item){emojiList+='<li class="emojione-item" title="'+item.title+'" data-code=":'+item.code+':"><img class="emojione-item-image" src="'+_.opts.emoji_path+item.unicode+'.png" /></li>'}),_.dom.innerHTML='<div class="comment loading" id="idisqus">\n    <div class="loading-container" data-tip="正在加载评论……"><svg class="loading-bg" width="72" height="72" viewBox="0 0 720 720" version="1.1" xmlns="http://www.w3.org/2000/svg"><path class="ring" fill="none" stroke="#9d9ea1" d="M 0 -260 A 260 260 0 1 1 -80 -260" transform="translate(400,400)" stroke-width="50" /><polygon transform="translate(305,20)" points="50,0 0,100 18,145 50,82 92,145 100,100" style="fill:#9d9ea1"/></svg></div>\n    <div class="comment-header"><span class="comment-header-item" id="comment-count">评论</span><a target="_blank" class="comment-header-item" id="comment-link">Disqus 讨论区</a></div>\n    <div class="comment-box">\n        <div class="comment-avatar avatar"><img class="comment-avatar-image" src="https://a.disquscdn.com/images/noavatar92.png"></div>\n        <div class="comment-form">\n            <div class="comment-form-wrapper">\n                <textarea class="comment-form-textarea" placeholder="加入讨论……"></textarea>\n                <div class="comment-form-alert"></div>\n                <div class="comment-image">\n                    <ul class="comment-image-list"></ul>\n                    <div class="comment-image-progress">\n                        <div class="comment-image-loaded"></div>\n                    </div>\n                </div>\n                <div class="comment-actions">\n                    <div class="comment-actions-group">\n                        <input id="emoji-input" class="comment-actions-input" type="checkbox"> \n                        <label class="comment-actions-label emojione" for="emoji-input" title="选择表情">\n                            <svg class="icon" fill="#c2c6cc" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200">\n                                <path d="M512 1024c-282.713043 0-512-229.286957-512-512s229.286957-512 512-512c282.713043 0 512 229.286957 512 512S792.486957 1024 512 1024zM512 44.521739c-258.226087 0-467.478261 209.252174-467.478261 467.478261 0 258.226087 209.252174 467.478261 467.478261 467.478261s467.478261-209.252174 467.478261-467.478261C979.478261 253.773913 768 44.521739 512 44.521739z"></path>\n                                <path d="M801.391304 554.295652c0 160.278261-129.113043 289.391304-289.391304 289.391304s-289.391304-129.113043-289.391304-289.391304L801.391304 554.295652z"></path>\n                                <path d="M674.504348 349.495652m-57.878261 0a2.6 2.6 0 1 0 115.756522 0 2.6 2.6 0 1 0-115.756522 0Z"></path>\n                                <path d="M347.269565 349.495652m-57.878261 0a2.6 2.6 0 1 0 115.756522 0 2.6 2.6 0 1 0-115.756522 0Z"></path>\n                            </svg>\n                            <ul class="emojione-list">'+emojiList+'</ul>\n                        </label>\n                        <input id="upload-input" class="comment-actions-input comment-image-input" type="file" accept="image/*" name="file"> \n                        <label class="comment-actions-label" for="upload-input" title="上传图片">\n                            <svg class="icon" fill="#c2c6cc" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200">\n                                <path d="M15.515152 15.515152 15.515152 15.515152 15.515152 15.515152Z"></path>\n                                <path d="M15.515152 139.636364l0 806.787879 992.969697 0 0-806.787879-992.969697 0zM946.424242 884.363636l-868.848485 0 0-682.666667 868.848485 0 0 682.666667zM698.181818 356.848485c0-51.417212 41.673697-93.090909 93.090909-93.090909s93.090909 41.673697 93.090909 93.090909c0 51.417212-41.673697 93.090909-93.090909 93.090909s-93.090909-41.673697-93.090909-93.090909zM884.363636 822.30303l-744.727273 0 186.181818-496.484848 248.242424 310.30303 124.121212-93.090909z"></path>\n                            </svg>\n                        </label>\n                    </div>\n                    <div class="comment-actions-form">\n                        <label class="comment-actions-label exit" title="重置访客信息">\n                            <svg class="icon" fill="#c2c6cc" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="48" height="48">\n                                <path d="M348.870666 210.685443l378.570081 0c32.8205 0 58.683541 26.561959 58.683541 58.683541 0 162.043606 0 324.804551 0 486.848157 0 32.81129-26.561959 58.674331-58.683541 58.674331L348.870666 814.891472c-10.477632 0-18.850323-8.363482-18.850323-18.841114l0-37.728276c0-10.477632 8.372691-18.841114 18.850323-18.841114l343.645664 0c10.477632 0 18.850323-8.372691 18.850323-18.850323L711.366653 304.983109c0-10.477632-8.372691-18.841114-18.850323-18.841114L348.870666 286.141996c-10.477632 0-18.850323-8.363482-18.850323-18.841114l0-37.728276C329.98248 219.095997 338.393034 210.685443 348.870666 210.685443z"></path>\n                                <path d="M128.152728 526.436804l112.450095 112.450095c6.985088 6.985088 19.567661 6.985088 26.552749 0l26.561959-26.561959c6.985088-6.985088 6.985088-19.567661 0-26.552749l-34.925441-34.925441L494.168889 550.84675c10.477632 0 18.850323-8.372691 18.850323-18.850323l0-37.719066c0-10.477632-8.372691-18.850323-18.850323-18.850323L258.754229 475.427036l34.925441-34.925441c6.985088-6.985088 6.985088-19.567661 0-26.552749l-26.561959-26.524097c-6.985088-6.985088-19.567661-6.985088-26.552749 0L128.152728 499.875868C120.431883 506.859933 120.431883 519.451716 128.152728 526.436804z"></path>\n                            </svg>\n                        </label>\n                        <button class="comment-form-submit">\n                            <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200">\n                                <path d="M565.747623 792.837176l260.819261 112.921839 126.910435-845.424882L66.087673 581.973678l232.843092 109.933785 562.612725-511.653099-451.697589 563.616588-5.996574 239.832274L565.747623 792.837176z" fill="#ffffff"></path>\n                            </svg>\n                        </button>\n                    </div>\n                </div>\n            </div>\n            <div class="comment-login"><input class="comment-form-input comment-form-name" type="text" placeholder="名字（必填）" autocomplete="name"><input class="comment-form-input comment-form-email" type="email" placeholder="邮箱（必填）" autocomplete="email"><input class="comment-form-input comment-form-url" type="url" placeholder="网址（可选）" autocomplete="url"></div>\n        </div>\n    </div>\n    <ul id="comments" class="comment-list"></ul>\n    <a href="javascript:;" class="comment-loadmore">加载更多</a>\n</div>\n<div class="comment" id="disqus_thread"></div>',_.guest=new Guest(_.dom),_.box=_.dom.querySelector(".comment-box").outerHTML.replace(/<label class="comment-actions-label exit"(.|\n)*<\/label>\n/,"").replace("comment-form-wrapper","comment-form-wrapper editing").replace(/加入讨论……/,""),_.handle={guestReset:_.guest.reset.bind(_.guest),loadMore:_.loadMore.bind(_),post:_.post.bind(_),postThread:_.postThread.bind(_),remove:_.remove.bind(_),show:_.show.bind(_),toggle:_.toggle.bind(_),upload:_.upload.bind(_),verify:_.verify.bind(_),jump:_.jump.bind(_),mention:_.mention.bind(_),keySelect:_.keySelect.bind(_),field:_.field,focus:_.focus,input:_.input},_.opts.mode){case 1:_.disqus();break;case 2:_.getlist();break;case 3:_.getlist(),_.disqus();break;default:_.disqus()}}},iDisqus.prototype.toggle=function(){var _=this;"disqus"==_.stat.current?(_.stat.current="idisqus",_.dom.querySelector("#idisqus").style.display="block",_.dom.querySelector("#disqus_thread").style.display="none"):_.disqus()},iDisqus.prototype.disqus=function(){var _=this,_tip=_.dom.querySelector(".loading-container").dataset.tip;if(_.opts.site==location.origin)if(_.stat.disqusLoaded)_.stat.current="disqus",_.dom.querySelector("#idisqus").style.display="none",_.dom.querySelector("#disqus_thread").style.display="block";else{_tip="尝试连接 Disqus……";var s=d.createElement("script");s.src="//"+_.opts.forum+".disqus.com/embed.js",s.dataset.timestamp=Date.now(),(d.head||d.body).appendChild(s);var timer=setTimeout(function(){s.parentNode.removeChild(s),clearTimeout(timer),1==_.opts.mode&&(_tip="连接超时，加载简易评论框……",_.getlist())},_.opts.timeout);s.onload=function(){_.stat.disqusLoaded=!0,clearTimeout(timer),_tip="连接成功，加载 Disqus 评论框……"},s.onerror=function(){1==_.opts.mode&&(_tip="连接失败，加载简易评论框……",_.getlist())}}else 1==_.opts.mode&&_.getlist()},iDisqus.prototype.count=function(){var _=this,counts=d.querySelectorAll("[data-disqus-url]"),qty=counts.length;if(qty>0){for(var commentArr=[],i=0;i<qty;i++)commentArr[i]=counts[i].dataset.disqusUrl.replace(_.opts.site,"");getAjax(_.opts.api+"/count.php?links="+commentArr.join(","),function(resp){JSON.parse(resp).response.forEach(function(item){var link=item.link.replace(_.opts.site,""),itemLink="/"!=link.slice(0,1)?"/"+link:link,el=d.querySelector('[data-disqus-url$="'+itemLink+'"]');el&&(el.innerHTML=item.posts,el.dataset.disqusCount=item.posts)})},function(){console.log("获取数据失败！")})}},iDisqus.prototype.popular=function(){var _=this;_.opts.popular&&getAjax(_.opts.api+"/popular.php",function(resp){var data=JSON.parse(resp);if(0==data.code){var postsHtml="";data.response.forEach(function(item){postsHtml+='<li><a href="'+item.link.replace(_.opts.site,"")+'" title="'+item.title+'">'+item.title+"</a></li>"}),_.opts.popular.innerHTML=postsHtml}},function(){console.log("获取数据失败！")})},iDisqus.prototype.getlist=function(){var _=this;_.stat.loading=!0,_.dom.querySelector("#idisqus").style.display="block",_.dom.querySelector("#disqus_thread").style.display="none",getAjax(_.opts.api+"/getcomments.php?link="+_.opts.identifier+(_.stat.next?"&cursor="+_.stat.next:""),function(resp){var data=JSON.parse(resp);if(data.auth||alert("认证出错，请查看后端配置中，Disqus 帐号密码是否填写有误。"),0===data.code){_.stat.offsetTop=d.documentElement.scrollTop||d.body.scrollTop,_.stat.thread=data.thread,_.stat.count=data.posts,_.dom.querySelector("#idisqus").classList.remove("loading"),_.dom.querySelector("#comment-link").href=data.link,_.dom.querySelector("#comment-count").innerHTML=_.stat.count+" 条评论";var loadmore=_.dom.querySelector(".comment-loadmore"),posts=data.response?data.response:[];if(_.stat.root=[],posts.forEach(function(item){_.load(item),item.parent||_.stat.root.unshift(item.id)}),data.cursor.hasPrev?_.stat.root.forEach(function(item){_.dom.querySelector(".comment-list").appendChild(_.dom.querySelector("#comment-"+item))}):(loadmore.addEventListener("click",_.handle.loadMore,!1),_.dom.querySelector(".exit").addEventListener("click",_.handle.guestReset,!1),_.dom.querySelector(".comment-form-textarea").addEventListener("blur",_.handle.focus,!1),_.dom.querySelector(".comment-form-textarea").addEventListener("focus",_.handle.focus,!1),_.dom.querySelector(".comment-form-textarea").addEventListener("input",_.handle.input,!1),_.dom.querySelector(".comment-form-textarea").addEventListener("keyup",_.handle.mention,!1),_.dom.querySelector(".comment-form-email").addEventListener("blur",_.handle.verify,!1),_.dom.querySelector(".comment-form-submit").addEventListener("click",_.handle.post,!1),_.dom.querySelector(".comment-image-input").addEventListener("change",_.handle.upload,!1),addListener(_.dom.getElementsByClassName("emojione-item"),"click",_.handle.field)),data.cursor.hasNext?(_.stat.next=data.cursor.next,loadmore.classList.remove("loading")):(_.stat.next=null,loadmore.classList.add("hide")),0==posts.length)return;if(window.scrollTo(0,_.stat.offsetTop),_.timeAgo(),/^#disqus|^#comment/.test(location.hash)&&!data.cursor.hasPrev&&!_.stat.disqusLoaded){var el=_.dom.querySelector("#idisqus "+location.hash);window.scrollBy(0,el.getBoundingClientRect().top)}_.stat.loading=!1,_.stat.loaded=!0}else 2===data.code&&_.create()},function(){alert("获取数据失败，请检查服务器设置。")})},iDisqus.prototype.load=function(post){var _=this,parentPostDom=_.dom.querySelector('.comment-item[data-id="'+post.parent+'"]'),user={username:post.username,name:post.name,avatar:post.avatar};post.username&&-1==_.stat.users.map(function(user){return user.username}).indexOf(post.username)&&_.stat.users.push(user);var parentPost=post.parent?{name:'<a class="comment-item-pname" href="#'+parentPostDom.id+'"><svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><path d="M1.664 902.144s97.92-557.888 596.352-557.888V129.728L1024 515.84l-425.984 360.448V628.8c-270.464 0-455.232 23.872-596.352 273.28"></path></svg>'+parentPostDom.dataset.name+"</a>",dom:parentPostDom.querySelector(".comment-item-children"),insert:"afterbegin"}:{name:"",dom:_.dom.querySelector(".comment-list"),insert:"preview"==post.id||post.isPost?"afterbegin":"beforeend"},mediaHTML="";post.media.length>0&&(post.media.forEach(function(item){mediaHTML+='<a class="comment-item-imagelink" target="_blank" href="'+item+'" ><img class="comment-item-image" src="'+item+'"></a>'}),mediaHTML='<div class="comment-item-images">'+mediaHTML+"</div>");var html='<li class="comment-item" data-id="'+post.id+'" data-name="'+post.name+'" id="comment-'+post.id+'"><div class="comment-item-body"><a class="comment-item-avatar" href="#comment-'+post.id+'"><img src="'+post.avatar+'"></a><div class="comment-item-main"><div class="comment-item-header"><a class="comment-item-name" title="'+post.name+'" rel="nofollow" target="_blank" href="'+(post.url?post.url:"javascript:;")+'">'+post.name+"</a>"+(post.isMod?'<span class="comment-item-badge">'+_.opts.badge+"</span>":"")+parentPost.name+'<span class="comment-item-bullet"> • </span><time class="comment-item-time" datetime="'+post.createdAt+'"></time></div><div class="comment-item-content">'+post.message+mediaHTML+'</div><div class="comment-item-footer">'+(post.isPost?'<span class="comment-item-manage"><a class="comment-item-edit" href="javascript:;">编辑</a><span class="comment-item-bullet"> • </span><a class="comment-item-delete" href="javascript:;">删除</a><span class="comment-item-bullet"> • </span></span>':"")+'<a class="comment-item-reply" href="javascript:;">回复</a> </div></div></div><ul class="comment-item-children"></ul></li>';if(post.isDeleted&&(html='<li class="comment-item" data-id="'+post.id+'" id="comment-'+post.id+'" data-name="已删除"><div class="comment-item-body"><a class="comment-item-avatar" href="#comment-'+post.id+'"><img src="'+post.avatar+'"></a><div class="comment-item-main" data-message="此评论已被删除。"></div></div><ul class="comment-item-children"></ul></li>'),_.dom.querySelector('.comment-item[data-id="'+post.id+'"]')?_.dom.querySelector('.comment-item[data-id="'+post.id+'"]').outerHTML=html:parentPost.dom.insertAdjacentHTML(parentPost.insert,html),post.isDeleted||(_.dom.querySelector('.comment-item[data-id="'+post.id+'"] .comment-item-reply').addEventListener("click",_.handle.show,!1),_.dom.querySelector('.comment-item[data-id="'+post.id+'"] .comment-item-avatar').addEventListener("click",_.handle.jump,!1),post.parent&&_.dom.querySelector('.comment-item[data-id="'+post.id+'"] .comment-item-pname').addEventListener("click",_.handle.jump,!1)),post.isPost&&!_.stat.editing){var $this=_.dom.querySelector('.comment-item[data-id="'+post.id+'"]');$this.querySelector(".comment-item-footer").insertAdjacentHTML("beforeend",'<span class="comment-item-tips">页面刷新前，十分钟内可编辑或删除</span>'),setTimeout(function(){$this.querySelector(".comment-item-tips")&&($this.querySelector(".comment-item-tips").outerHTML="")},5e3);var postEdit=setTimeout(function(){$this.querySelector(".comment-item-manage")&&($this.querySelector(".comment-item-manage").outerHTML="")},6e5);$this.querySelector(".comment-item-delete").addEventListener("click",function(e){var postData={id:post.id};e.currentTarget.innerHTML="删除中",postAjax(_.opts.api+"/removecomment.php",postData,function(resp){var data=JSON.parse(resp);0===data.code?1==data.response.isDeleted?$this.outerHTML="":(alert(data.response.message),$this.querySelector(".comment-item-manage").outerHTML=""):2===data.code&&(alert(data.response),$this.querySelector(".comment-item-manage").outerHTML="")},function(){alert("删除出错，请稍后重试")}),clearTimeout(postEdit)},!1),$this.querySelector(".comment-item-edit").addEventListener("click",function(){_.stat.editing=post,_.edit(post)},!1)}},iDisqus.prototype.loadMore=function(e){var _=this;_.stat.loading||(e.currentTarget.classList.add("loading"),_.getlist())},iDisqus.prototype.focus=function(e){var wrapper=e.currentTarget.closest(".comment-form-wrapper");wrapper.classList.add("editing"),wrapper.classList.contains("focus")?wrapper.classList.remove("focus"):wrapper.classList.add("focus")},iDisqus.prototype.input=function(e){e.currentTarget.closest(".comment-form").querySelector(".comment-form-alert").innerHTML=""},iDisqus.prototype.mention=function(e){var _=this,textarea=e.currentTarget,selStart=textarea.selectionStart,mentionIndex=textarea.value.slice(0,selStart).lastIndexOf("@"),mentionText=textarea.value.slice(mentionIndex,selStart),mentionDom=_.dom.querySelector(".mention-user");if(0==mentionText.search(/^@\w+$|^@$/)){if(38==e.keyCode||40==e.keyCode)return;var showUsers=_.stat.users.filter(function(user){var re=new RegExp(mentionText.slice(1),"i");return user.username.search(re)>-1}),coord=_.getCaretCoord(textarea),list="",html="";showUsers.length>0?(showUsers.forEach(function(item,i){list+='<li class="mention-user-item'+(0==i?" active":"")+'" data-username="'+item.username+'"><img class="mention-user-avatar" src="'+item.avatar+'"><div class="mention-user-username">'+item.username+'</div><div class="mention-user-name">'+item.name+"</div></li>"}),mentionDom?(mentionDom.innerHTML='<ul class="mention-user-list">'+list+"</ul>",mentionDom.style.left=coord.left+"px",mentionDom.style.top=coord.top+"px"):(html='<div class="mention-user" style="left:'+coord.left+"px;top:"+coord.top+'px"><ul class="mention-user-list">'+list+"</ul></div>",_.dom.querySelector("#idisqus").insertAdjacentHTML("beforeend",html)),addListener(_.dom.getElementsByClassName("mention-user-item"),"mouseover",function(){_.dom.querySelector(".mention-user-item.active").classList.remove("active"),this.classList.add("active")}),addListener(_.dom.getElementsByClassName("mention-user-item"),"click",function(){var username="@"+this.dataset.username+" ";textarea.value=textarea.value.slice(0,mentionIndex)+username+textarea.value.slice(selStart),_.dom.querySelector(".mention-user").outerHTML="",textarea.focus(),textarea.setSelectionRange(mentionIndex+username.length,mentionIndex+username.length),textarea.removeEventListener("keydown",_.handle.keySelect,!1)}),textarea.addEventListener("keydown",_.handle.keySelect,!1)):mentionDom&&(mentionDom.outerHTML="",textarea.removeEventListener("keydown",_.handle.keySelect,!1))}else mentionDom&&(mentionDom.outerHTML="",textarea.removeEventListener("keydown",_.handle.keySelect,!1))},iDisqus.prototype.getCaretCoord=function(textarea){var _=this,carPos=textarea.selectionEnd,div=d.createElement("div"),span=d.createElement("span"),copyStyle=getComputedStyle(textarea);[].forEach.call(copyStyle,function(prop){div.style[prop]=copyStyle[prop]}),div.style.position="absolute",_.dom.appendChild(div),div.textContent=textarea.value.substr(0,carPos),span.textContent=textarea.value.substr(carPos)||".",div.appendChild(span);var coords={top:textarea.offsetTop-textarea.scrollTop+span.offsetTop+parseFloat(copyStyle.lineHeight),left:textarea.offsetLeft-textarea.scrollLeft+span.offsetLeft};return _.dom.removeChild(div),coords},iDisqus.prototype.keySelect=function(e){var _=this,textarea=e.currentTarget,selStart=textarea.selectionStart,mentionIndex=textarea.value.slice(0,selStart).lastIndexOf("@"),current=(textarea.value.slice(mentionIndex,selStart),_.dom.querySelector(".mention-user"),_.dom.querySelector(".mention-user-item.active"));switch(e.keyCode){case 13:var username="@"+current.dataset.username+" ";textarea.value=textarea.value.slice(0,mentionIndex)+username+textarea.value.slice(selStart),textarea.setSelectionRange(mentionIndex+username.length,mentionIndex+username.length),_.dom.querySelector(".mention-user").outerHTML="",textarea.removeEventListener("keydown",_.handle.keySelect,!1),e.preventDefault();break;case 38:current.previousSibling&&(current.previousSibling.classList.add("active"),current.classList.remove("active")),e.preventDefault();break;case 40:current.nextSibling&&(current.nextSibling.classList.add("active"),current.classList.remove("active")),e.preventDefault()}},iDisqus.prototype.jump=function(e){var _=this,hash=getLocation(e.currentTarget.href).hash,el=_.dom.querySelector("#idisqus "+hash);history.replaceState(void 0,void 0,hash),window.scrollBy(0,el.getBoundingClientRect().top),e.preventDefault()},iDisqus.prototype.field=function(e){var item=e.currentTarget,textarea=item.closest(".comment-form").querySelector(".comment-form-textarea"),selStart=textarea.selectionStart,shortCode=0==selStart?item.dataset.code+" ":" "+item.dataset.code+" ";textarea.value=textarea.value.slice(0,selStart)+shortCode+textarea.value.slice(selStart),textarea.focus(),textarea.setSelectionRange(selStart+shortCode.length,selStart+shortCode.length)},iDisqus.prototype.show=function(e){var _=this,$this=e.currentTarget,item=$this.closest(".comment-item"),box=_.dom.querySelector(".comment-item .comment-box:not([data-current-id])");if(box){var cancel=box.closest(".comment-item").querySelector(".comment-item-cancel");cancel.outerHTML=cancel.outerHTML.replace("cancel","reply"),box.outerHTML=""}if("comment-item-reply"==$this.className){$this.outerHTML=$this.outerHTML.replace("reply","cancel");var commentBox=_.box.replace(/emoji-input/g,"emoji-input-"+item.dataset.id).replace(/upload-input/g,"upload-input-"+item.dataset.id);item.querySelector(".comment-item-children").insertAdjacentHTML("beforebegin",commentBox),_.guest.init(),item.querySelector(".comment-form-textarea").addEventListener("blur",_.handle.focus,!1),item.querySelector(".comment-form-textarea").addEventListener("focus",_.handle.focus,!1),item.querySelector(".comment-form-textarea").addEventListener("keyup",_.handle.mention,!1),item.querySelector(".comment-form-textarea").addEventListener("input",_.handle.input,!1),item.querySelector(".comment-form-email").addEventListener("blur",_.handle.verify,!1),item.querySelector(".comment-form-submit").addEventListener("click",_.handle.post,!1),item.querySelector(".comment-image-input").addEventListener("change",_.handle.upload,!1),addListener(item.getElementsByClassName("emojione-item"),"click",_.handle.field),item.querySelector(".comment-form-textarea").focus()}addListener(_.dom.getElementsByClassName("comment-item-reply"),"click",_.handle.show),addListener(_.dom.getElementsByClassName("comment-item-cancel"),"click",_.handle.show)},iDisqus.prototype.verify=function(e){var _=this,box=e.currentTarget.closest(".comment-box"),avatar=box.querySelector(".comment-avatar-image"),email=box.querySelector(".comment-form-email");box.querySelector(".comment-form-alert");/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(email.value)&&getAjax(_.opts.api+"/getgravatar.php?email="+email.value,function(resp){"false"==resp?_.errorTips("您所填写的邮箱地址有误。",email):avatar.src=resp},function(){})},iDisqus.prototype.upload=function(e){var _=this,file=e.currentTarget,form=file.closest(".comment-form"),progress=form.querySelector(".comment-image-progress"),loaded=form.querySelector(".comment-image-loaded"),wrapper=form.querySelector(".comment-form-wrapper"),alertmsg=form.querySelector(".comment-form-alert");if(alertmsg.innerHTML="",0!==file.files.length){var size=file.files[0].size;if(size>5e6)return alertmsg.innerHTML="请选择 5M 以下图片。",void setTimeout(function(){alertmsg.innerHTML=""},3e3);if(-1!=_.stat.imageSize.indexOf(size))return alertmsg.innerHTML="请勿选择已存在的图片。",void setTimeout(function(){alertmsg.innerHTML=""},3e3);progress.style.width="80px",wrapper.classList.add("expanded");var data=new FormData;data.append("file",file.files[0]);var $item,filename=file.files[0].name,xhrUpload=new XMLHttpRequest;xhrUpload.onreadystatechange=function(){if(4==xhrUpload.readyState&&200==xhrUpload.status){var data=JSON.parse(xhrUpload.responseText);if(0==data.code){_.stat.imageSize.push(size);var imageUrl=data.response[filename].url,image=new Image;image.src=imageUrl,image.onload=function(){$item.innerHTML='<img class="comment-image-object" src="'+imageUrl+'">',$item.dataset.imageUrl=imageUrl,$item.classList.remove("loading"),$item.addEventListener("click",_.handle.remove,!1)}}else alertmsg.innerHTML="图片上传出错。",$item.innerHTML="",form.getElementsByClassName("comment-image-item").length&&wrapper.classList.remove("expanded"),setTimeout(function(){alertmsg.innerHTML=""},3e3)}},xhrUpload.upload.addEventListener("progress",function(e){loaded.style.width=Math.ceil(e.loaded/e.total*100)+"%"},!1),xhrUpload.upload.addEventListener("load",function(e){loaded.style.width=0,progress.style.width=0;var imageItem='<li class="comment-image-item loading" data-image-size="'+size+'">\n    <svg version="1.1" class="comment-image-object" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n        width="24px" height="30px" viewBox="0 0 24 30" style="enable-background: new 0 0 50 50;" xml:space="preserve">\n        <rect x="0" y="10" width="4" height="10" fill="rgba(127,145,158,1)" opacity="0.2">\n            <animate attributeName="opacity" attributeType="XML" values="0.2; 1; .2" begin="0s" dur="0.6s" repeatCount="indefinite" />\n            <animate attributeName="height" attributeType="XML" values="10; 20; 10" begin="0s" dur="0.6s" repeatCount="indefinite" />\n            <animate attributeName="y" attributeType="XML" values="10; 5; 10" begin="0s" dur="0.6s" repeatCount="indefinite" />\n        </rect>\n        <rect x="8" y="10" width="4" height="10" fill="rgba(127,145,158,1)" opacity="0.2">\n            <animate attributeName="opacity" attributeType="XML" values="0.2; 1; .2" begin="0.15s" dur="0.6s" repeatCount="indefinite" />\n            <animate attributeName="height" attributeType="XML" values="10; 20; 10" begin="0.15s" dur="0.6s" repeatCount="indefinite" />\n            <animate attributeName="y" attributeType="XML" values="10; 5; 10" begin="0.15s" dur="0.6s" repeatCount="indefinite" />\n        </rect>\n        <rect x="16" y="10" width="4" height="10" fill="rgba(127,145,158,1)" opacity="0.2">\n            <animate attributeName="opacity" attributeType="XML" values="0.2; 1; .2" begin="0.3s" dur="0.6s" repeatCount="indefinite" />\n            <animate attributeName="height" attributeType="XML" values="10; 20; 10" begin="0.3s" dur="0.6s" repeatCount="indefinite" />\n            <animate attributeName="y" attributeType="XML" values="10; 5; 10" begin="0.3s" dur="0.6s" repeatCount="indefinite" />\n        </rect>\n    </svg>\n</li>\n';form.querySelector(".comment-image-list").insertAdjacentHTML("beforeend",imageItem),$item=form.querySelector('[data-image-size="'+size+'"]')},!1),xhrUpload.open("POST",_.opts.api+"/upload.php",!0),xhrUpload.send(data)}},iDisqus.prototype.remove=function(e){var _=this,$item=e.currentTarget.closest(".comment-image-item"),wrapper=e.currentTarget.closest(".comment-form-wrapper");$item.outerHTML="",_.stat.imageSize=[];var imageArr=wrapper.getElementsByClassName("comment-image-item");[].forEach.call(imageArr,function(item,i){_.stat.imageSize[i]=item.dataset.imageSize}),0==_.stat.imageSize.length&&wrapper.classList.remove("expanded"),wrapper.querySelector(".comment-image-input").value=""},iDisqus.prototype.errorTips=function(Text,Dom){var _=this;"true"==_.guest.logged_in&&_.handle.guestReset();var idisqus=_.dom.querySelector("#idisqus"),errorDom=_.dom.querySelector(".comment-form-error");errorDom&&(errorDom.outerHTML="");var errorHtml='<div class="comment-form-error" style="top:'+Dom.offsetTop+"px;left:"+Dom.offsetLeft+'px;">'+Text+"</div>";idisqus.insertAdjacentHTML("beforeend",errorHtml),setTimeout(function(){var errorDom=_.dom.querySelector(".comment-form-error");errorDom&&(errorDom.outerHTML="")},3e3)},iDisqus.prototype.post=function(e){var _=this,item=e.currentTarget.closest(".comment-box[data-current-id]")||e.currentTarget.closest(".comment-item")||e.currentTarget.closest(".comment-box"),message=item.querySelector(".comment-form-textarea").value,parentId=item.dataset.id?item.dataset.id:"",imgArr=item.getElementsByClassName("comment-image-item"),media=[],mediaStr="";if([].forEach.call(imgArr,function(image,i){media[i]=image.dataset.imageUrl,mediaStr+=" "+image.dataset.imageUrl}),!item.dataset.currentId){var elName=item.querySelector(".comment-form-name"),elEmail=item.querySelector(".comment-form-email"),elUrl=item.querySelector(".comment-form-url"),guest={name:elName.value,email:elEmail.value,url:elUrl.value.replace(/\s/g,""),avatar:item.querySelector(".comment-avatar-image").src},alertmsg=item.querySelector(".comment-form-alert");function alertClear(){setTimeout(function(){alertmsg.innerHTML=""},3e3)}if(/^\s*$/i.test(guest.name))return void _.errorTips("名字不能为空。",elName);if(/^\s*$/i.test(guest.email))return void _.errorTips("邮箱不能为空。",elEmail);if(!/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(guest.email))return void _.errorTips("请正确填写邮箱。",elEmail);if(!/^([hH][tT]{2}[pP]:\/\/|[hH][tT]{2}[pP][sS]:\/\/)(([A-Za-z0-9-~]+)\.)+([A-Za-z0-9-~\/])+$|^\s*$/i.test(guest.url))return void _.errorTips("请正确填写网址。",elUrl);if(_.guest.submit(guest),_.stat.message||_.stat.mediaHtml||(_.box=_.dom.querySelector(".comment-box").outerHTML.replace(/<label class="comment-actions-label exit"(.|\n)*<\/label>\n/,"").replace("comment-form-wrapper","comment-form-wrapper editing").replace(/加入讨论……/,"")),!_.guest.name&&!_.guest.email)return;if(0==media.length&&/^\s*$/i.test(message))return alertmsg.innerHTML="评论不能为空或空格。",void item.querySelector(".comment-form-textarea").focus();var preMessage=message;_.opts.emoji_preview?preMessage=preMessage.replace(/:([-+\w]+):/g,function(match){var emojiShort=match.replace(/:/g,"");return _.eac[emojiShort]?'<img class="emojione" width="24" height="24" alt="'+emojiShort+'" title=":'+emojiShort+':" src="'+_.opts.emoji_path+_.eac[emojiShort]+'.png">':match}):_.emoji_list.forEach(function(item){preMessage=preMessage.replace(":"+item.code+":",'<img class="emojione" width="24" height="24" src="'+_.opts.emoji_path+item.unicode+'.png" />')});var post={url:_.guest.url?_.guest.url:"",isMod:!1,username:null,name:_.guest.name,avatar:_.guest.avatar,id:"preview",parent:parentId,createdAt:(new Date).toJSON(),message:"<p>"+preMessage+"</p>",media:media};_.load(post),_.timeAgo(),_.stat.message=message,_.stat.mediaHtml=item.querySelector(".comment-image-list").innerHTML,parentId?item.querySelector(".comment-item-cancel").click():(item.querySelector(".comment-form-textarea").value="",item.querySelector(".comment-image-list").innerHTML="",item.querySelector(".comment-form-wrapper").classList.remove("expanded","editing"))}var mentions=message.match(/@\w+/g);if(mentions&&(mentions=mentions.filter(function(mention){return _.stat.users.map(function(user){return user.username}).indexOf(mention.slice(1))>-1})).length>0){var re=new RegExp("("+mentions.join("|")+")","g");message=message.replace(re,"$1:disqus")}if(message+=mediaStr,item.dataset.currentId){postData={id:item.dataset.currentId,message:message};postAjax(_.opts.api+"/updatecomment.php",postData,function(resp){var data=JSON.parse(resp);if(0===data.code){_.stat.message=null,_.stat.mediaHtml=null;var post=data.response;_.load(post),_.timeAgo(),_.stat.editing=!1}else _.load(_.stat.editing),_.timeAgo(),_.stat.editing=!1},function(){_.load(_.stat.editing),_.timeAgo(),_.stat.editing=!1})}else{var postData={thread:_.stat.thread,parent:parentId,message:message,name:_.guest.name,email:_.guest.email,url:_.guest.url,link:_.opts.url,title:_.opts.title};postAjax(_.opts.api+"/postcomment.php",postData,function(resp){var data=JSON.parse(resp);if(0===data.code){_.dom.querySelector('.comment-item[data-id="preview"]').outerHTML="",_.stat.count+=1,_.dom.querySelector("#comment-count").innerHTML=_.stat.count+" 条评论";var post=data.response;post.isPost=!0,_.load(post),_.timeAgo()}else 2===data.code&&(alertmsg.innerHTML=data.response,_.dom.querySelector('.comment-item[data-id="preview"]').outerHTML="",_.reEdit(item),data.response.indexOf("author")>-1&&_.handle.guestReset())},function(){alertmsg.innerHTML="提交出错，请稍后重试。",alertClear(),_.dom.querySelector('.comment-item[data-id="preview"]').outerHTML="",_.reEdit(item)})}},iDisqus.prototype.reEdit=function(item){var _=this;item.dataset.id?item.querySelector(".comment-item-reply").click():item.querySelector(".comment-form-wrapper").classList.add("editing"),_.stat.message&&(item.querySelector(".comment-form-textarea").value=_.stat.message),_.stat.mediaHtml&&(item.querySelector(".comment-form-wrapper").classList.add("expanded"),item.querySelector(".comment-image-list").innerHTML=_.stat.mediaHtml,addListener(item.getElementsByClassName("comment-image-item"),"click",_.handle.remove))},iDisqus.prototype.edit=function(post){var _=this,commentBox=_.box.replace("comment-box","comment-box comment-box-"+post.id).replace(/emoji-input/g,"emoji-input-"+post.id).replace(/upload-input/g,"upload-input-"+post.id);_.dom.querySelector('.comment-item[data-id="'+post.id+'"] .comment-item-body').outerHTML=commentBox,_.guest.init();var item=_.dom.querySelector(".comment-box-"+post.id);item.dataset.currentId=post.id,item.querySelector(".comment-form-textarea").addEventListener("blur",_.handle.focus,!1),item.querySelector(".comment-form-textarea").addEventListener("focus",_.handle.focus,!1),item.querySelector(".comment-form-textarea").addEventListener("input",_.handle.input,!1),item.querySelector(".comment-form-textarea").addEventListener("keyup",_.handle.mention,!1),item.querySelector(".comment-form-email").addEventListener("blur",_.handle.verify,!1),item.querySelector(".comment-form-submit").addEventListener("click",_.handle.post,!1),item.querySelector(".comment-image-input").addEventListener("change",_.handle.upload,!1),addListener(item.getElementsByClassName("emojione-item"),"click",_.handle.field),item.querySelector(".comment-form-textarea").focus(),item.querySelector(".comment-actions-form").insertAdjacentHTML("afterbegin",'<a class="comment-form-cancel" href="javascript:;">取消</a>'),item.querySelector(".comment-form-cancel").addEventListener("click",function(){_.stat.editing=!1,_.load(post),_.timeAgo()},!1),_.stat.message&&(item.querySelector(".comment-form-textarea").value=_.stat.message),_.stat.mediaHtml&&(item.querySelector(".comment-form-wrapper").classList.add("expanded"),item.querySelector(".comment-image-list").innerHTML=_.stat.mediaHtml,addListener(item.getElementsByClassName("comment-image-item"),"click",_.handle.remove))},iDisqus.prototype.create=function(){var _=this;if(_.opts.auto){_.dom.querySelector(".loading-container").dataset.tip="正在创建 Thread……";var postData={url:_.opts.link,identifier:_.opts.identifier,title:_.opts.title,slug:_.opts.slug,message:_.opts.desc};_.postThread(postData)}else _.dom.querySelector("#idisqus").classList.remove("loading"),_.dom.querySelector("#idisqus").innerHTML='<div class="comment-header"><span class="comment-header-item">创建 Thread</span></div><div class="comment-thread-form"><p>由于 Disqus 没有本页面的相关 Thread，故需先创建 Thread</p><div class="comment-form-item"><label class="comment-form-label">url:</label><input class="comment-form-input" id="thread-url" name="url" value="'+_.opts.link+'" disabled /></div><div class="comment-form-item"><label class="comment-form-label">identifier:</label><input class="comment-form-input" id="thread-identifier" name="identifier" value="'+_.opts.identifier+'" disabled /></div><div class="comment-form-item"><label class="comment-form-label">title:</label><input class="comment-form-input" id="thread-title" name="title" value="'+_.opts.title+'" disabled /></div><div class="comment-form-item"><label class="comment-form-label">slug:</label><input class="comment-form-input" id="thread-slug" name="slug" value="'+_.opts.slug+'" /></div><div class="comment-form-item"><label class="comment-form-label">message:</label><textarea class="comment-form-textarea" id="thread-message" name="message">'+_.opts.desc+'</textarea></div><button id="thread-submit" class="comment-form-submit">提交</button></div>',_.dom.querySelector("#thread-submit").addEventListener("click",_.handle.postThread,!1)},iDisqus.prototype.postThread=function(){var _=this;if(arguments[0].target)postData={url:_.dom.querySelector("#thread-url").value,identifier:_.dom.querySelector("#thread-identifier").value,title:_.dom.querySelector("#thread-title").value,slug:_.dom.querySelector("#thread-slug").value.replace(/[^A-Za-z0-9_-]+/g,""),message:_.dom.querySelector("#thread-message").value};else var postData=arguments[0];postAjax(_.opts.api+"/createthread.php",postData,function(resp){var data=JSON.parse(resp);if(0!==data.code)return 2===data.code?data.response.indexOf("A thread already exists with link")>-1?void alert(data.response.replace("A thread already exists with link,","已存在此链接的相关 Thread，")):data.response.indexOf("Invalid URL")>-1?void alert("参数错误，无效的'URL'"):data.response.indexOf("Invalid slug")>-1?void alert("参数错误，无效的'slug'"):void alert(data.response):void alert(data.response);alert("创建 Thread 成功，刷新后便可愉快地评论了！"),setTimeout(function(){location.reload()},2e3)},function(){alert("创建 Thread 出错，请稍后重试！")})},iDisqus.prototype.destroy=function(){var _=this;_.dom.querySelector(".exit").removeEventListener("click",_.handle.guestReset,!1),removeListener(_.dom.getElementsByClassName("comment-form-textarea"),"blur",_.handle.focus),removeListener(_.dom.getElementsByClassName("comment-form-textarea"),"focus",_.handle.focus),removeListener(_.dom.getElementsByClassName("comment-form-textarea"),"keyup",_.handle.mention),removeListener(_.dom.getElementsByClassName("comment-form-email"),"blur",_.handle.verify),removeListener(_.dom.getElementsByClassName("comment-form-submit"),"click",_.handle.post),removeListener(_.dom.getElementsByClassName("comment-image-input"),"change",_.handle.upload),removeListener(_.dom.getElementsByClassName("comment-item-reply"),"click",_.handle.show),removeListener(_.dom.getElementsByClassName("comment-loadmore"),"click",_.handle.loadMore),removeListener(_.dom.getElementsByClassName("emojione-item"),"click",_.handle.field),_.dom.innerHTML="",delete _.box,delete _.dom,delete _.emoji_list,delete _.guest,delete _.handle,delete _.opts,delete _.stat},"function"==typeof require&&"object"==typeof module&&module&&"object"==typeof exports&&exports?module.exports=iDisqus:"function"==typeof define&&define.amd?define(function(){return iDisqus}):global.iDisqus=global.iDisqus||iDisqus}(window||this);